<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Receipt Analyzer</title>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
      <style>
            body {
                  background-color: #f0f2f5;
                  height: 100vh;
                  display: flex;
                  align-items: center;
                  justify-content: center;
            }
            .container {
                  background: #ffffff;
                  border-radius: 10px;
                  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                  padding: 30px;
                  max-width: 500px;
                  width: 100%;
            }
            h1 {
                  font-size: 2rem;
                  margin-bottom: 20px;
            }
            button {
                  background-color: #007bff;
                  border: none;
            }
            button:hover {
                  background-color: #0056b3;
            }
            #result {
                  margin-top: 20px;
                  white-space: pre-wrap;
                  background: #f8f9fa;
                  padding: 15px;
                  border-radius: 5px;
                  border: 1px solid #e9ecef;
            }
            #askSection {
                  margin-top: 20px;
            }
      </style>
</head>
<body>
      <div class="container">
            <h1 class="text-center">Receipt Analyzer</h1>
            <form id="receiptForm" method="POST" action="/analyze-receipt" enctype="multipart/form-data">
                  <div class="mb-3">
                  <label for="receipt" class="form-label">Upload Receipt</label>
                  <input type="file" class="form-control" id="receipt" name="receipt" accept="image/*" required>
                  </div>
                  <button type="submit" class="btn btn-primary w-100">Analyze Receipt</button>
            </form>
            <div id="result" class="mt-4"></div>

            <div id="askSection" style="display:none;">
                  <h3 class="text-center">Ask a Question</h3>
                  <div class="mb-3">
                  <label for="question" class="form-label">Your Question</label>
                  <input type="text" class="form-control" id="question" placeholder="Ask about the receipt...">
                  </div>
                  <button id="askButton" class="btn btn-success w-100">Ask</button>
                  <div id="answer" class="mt-3"></div>
            </div>
      </div>

      <script>
            const form = document.getElementById('receiptForm');
            const resultDiv = document.getElementById('result');
            const askSection = document.getElementById('askSection');
            const askButton = document.getElementById('askButton');
            const questionInput = document.getElementById('question');
            const answerDiv = document.getElementById('answer');

            let analyzedData = null;

            form.addEventListener('submit', async (e) => {
                  e.preventDefault();
                  resultDiv.innerHTML = '<p class="text-info">Analyzing...</p>';
            
                  const formData = new FormData(form);
            
                  try {
                        const response = await fetch('/analyze-receipt', {
                              method: 'POST',
                              body: formData
                        });
                        
                        const result = await response.text(); // Use .text() for plain-text (HTML) responses
            
                        if (response.ok) {
                              analyzedData = result; // Save the analyzed data as text
                              resultDiv.innerHTML = result; // Render the HTML directly
                              askSection.style.display = 'block';
                        } else {
                              resultDiv.innerHTML = `<p class="text-danger">${result}</p>`;
                        }
                  } catch (error) {
                        resultDiv.innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
                  }
                  });
            
                  
                  askButton.addEventListener('click', async () => {
                        const question = questionInput.value.trim();
                        if (!question) {
                              answerDiv.innerHTML = '<p class="text-warning">Please enter a question.</p>';
                              return;
                        }
                  
                        answerDiv.innerHTML = '<p class="text-info">Answering...</p>';
                  
                        try {
                        const response = await fetch('/ask-question', {
                              method: 'POST',
                              headers: {
                                    'Content-Type': 'application/json',
                              },
                              body: JSON.stringify({ question }),
                        });
                  
                        const answer = await response.text(); 
                  
                        if (response.ok) {
                              answerDiv.innerHTML = `<p>${answer}</p>`;
                        } else {
                              answerDiv.innerHTML = `<p class="text-danger">${answer}</p>`;
                        }
                        } catch (error) {
                        answerDiv.innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
                        }
                  });
                  
      </script>
</body>
</html>