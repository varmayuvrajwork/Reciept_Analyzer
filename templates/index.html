<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Receipt Analyzer AI</title>
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
      <style>
            * {
                  margin: 0;
                  padding: 0;
                  box-sizing: border-box;
            }

            body {
                  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                  min-height: 100vh;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  padding: 24px;
                  line-height: 1.6;
            }

            .main-container {
                  max-width: 1200px;
                  width: 100%;
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 32px;
                  animation: fadeIn 0.6s ease-out;
            }

            @keyframes fadeIn {
                  from {
                        opacity: 0;
                        transform: translateY(20px);
                  }
                  to {
                        opacity: 1;
                        transform: translateY(0);
                  }
            }

            .card {
                  background: rgba(255, 255, 255, 0.95);
                  backdrop-filter: blur(20px);
                  border-radius: 24px;
                  padding: 40px;
                  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                  transition: all 0.3s ease;
            }

            .card:hover {
                  transform: translateY(-4px);
                  box-shadow: 0 24px 70px rgba(0, 0, 0, 0.35);
            }

            .header {
                  text-align: center;
                  margin-bottom: 40px;
            }

            .header h1 {
                  font-size: 2.5rem;
                  font-weight: 700;
                  color: #1a202c;
                  margin-bottom: 12px;
                  letter-spacing: -0.5px;
            }

            .header p {
                  font-size: 1.125rem;
                  color: #718096;
                  font-weight: 400;
            }

            .upload-area {
                  border: 3px dashed #cbd5e0;
                  border-radius: 16px;
                  padding: 48px 24px;
                  text-align: center;
                  transition: all 0.3s ease;
                  cursor: pointer;
                  background: #f7fafc;
                  position: relative;
                  overflow: hidden;
            }

            .upload-area:hover {
                  border-color: #667eea;
                  background: #edf2f7;
            }

            .upload-area.dragover {
                  border-color: #667eea;
                  background: #e6f0ff;
                  transform: scale(1.02);
            }

            .upload-icon {
                  width: 64px;
                  height: 64px;
                  margin: 0 auto 16px;
                  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                  border-radius: 50%;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  transition: transform 0.3s ease;
            }

            .upload-area:hover .upload-icon {
                  transform: scale(1.1) rotate(5deg);
            }

            .upload-icon svg {
                  width: 32px;
                  height: 32px;
                  stroke: white;
                  fill: none;
                  stroke-width: 2;
            }

            .upload-text {
                  font-size: 1.125rem;
                  font-weight: 600;
                  color: #2d3748;
                  margin-bottom: 8px;
            }

            .upload-subtext {
                  font-size: 0.875rem;
                  color: #718096;
            }

            input[type="file"] {
                  display: none;
            }

            .btn {
                  width: 100%;
                  padding: 16px 32px;
                  font-size: 1rem;
                  font-weight: 600;
                  border: none;
                  border-radius: 12px;
                  cursor: pointer;
                  transition: all 0.3s ease;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  gap: 8px;
                  margin-top: 24px;
            }

            .btn-primary {
                  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                  color: white;
                  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            }

            .btn-primary:hover:not(:disabled) {
                  transform: translateY(-2px);
                  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
            }

            .btn-primary:disabled {
                  opacity: 0.6;
                  cursor: not-allowed;
            }

            .btn-secondary {
                  background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
                  color: white;
                  box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
            }

            .btn-secondary:hover:not(:disabled) {
                  transform: translateY(-2px);
                  box-shadow: 0 6px 20px rgba(72, 187, 120, 0.5);
            }

            .preview-container {
                  margin-top: 24px;
                  border-radius: 12px;
                  overflow: hidden;
                  display: none;
                  animation: slideDown 0.3s ease;
            }

            @keyframes slideDown {
                  from {
                        opacity: 0;
                        max-height: 0;
                  }
                  to {
                        opacity: 1;
                        max-height: 500px;
                  }
            }

            .preview-container img {
                  width: 100%;
                  height: auto;
                  display: block;
                  border-radius: 12px;
                  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            }

            .results-panel {
                  display: none;
                  animation: fadeIn 0.5s ease;
            }

            .results-panel.active {
                  display: block;
            }

            .result-box {
                  background: #f7fafc;
                  border-radius: 12px;
                  padding: 24px;
                  margin-bottom: 24px;
                  border-left: 4px solid #667eea;
                  animation: slideIn 0.4s ease;
            }

            @keyframes slideIn {
                  from {
                        opacity: 0;
                        transform: translateX(-20px);
                  }
                  to {
                        opacity: 1;
                        transform: translateX(0);
                  }
            }

            .result-box h3 {
                  font-size: 1.25rem;
                  font-weight: 600;
                  color: #2d3748;
                  margin-bottom: 16px;
            }

            .result-content {
                  color: #4a5568;
                  white-space: pre-wrap;
                  line-height: 1.8;
                  font-size: 0.9375rem;
            }

            .question-input {
                  width: 100%;
                  padding: 16px;
                  border: 2px solid #e2e8f0;
                  border-radius: 12px;
                  font-size: 1rem;
                  font-family: 'Inter', sans-serif;
                  transition: all 0.3s ease;
                  background: white;
            }

            .question-input:focus {
                  outline: none;
                  border-color: #667eea;
                  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }

            .answer-box {
                  margin-top: 24px;
                  padding: 24px;
                  background: linear-gradient(135deg, #f0f4ff 0%, #e6f0ff 100%);
                  border-radius: 12px;
                  border: 1px solid #d0deff;
                  display: none;
                  animation: slideDown 0.3s ease;
            }

            .answer-box.active {
                  display: block;
            }

            .answer-box p {
                  color: #2d3748;
                  line-height: 1.8;
            }

            .loading {
                  display: inline-block;
                  width: 20px;
                  height: 20px;
                  border: 3px solid rgba(255, 255, 255, 0.3);
                  border-radius: 50%;
                  border-top-color: white;
                  animation: spin 0.8s linear infinite;
            }

            @keyframes spin {
                  to { transform: rotate(360deg); }
            }

            .badge {
                  display: inline-block;
                  padding: 6px 12px;
                  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                  color: white;
                  border-radius: 20px;
                  font-size: 0.875rem;
                  font-weight: 600;
                  margin-bottom: 16px;
            }

            .receipt-image-result {
                  margin-top: 16px;
                  border-radius: 12px;
                  overflow: hidden;
            }

            .receipt-image-result img {
                  width: 100%;
                  height: auto;
                  display: block;
                  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            }

            @media (max-width: 968px) {
                  .main-container {
                        grid-template-columns: 1fr;
                  }

                  .header h1 {
                        font-size: 2rem;
                  }

                  .card {
                        padding: 32px 24px;
                  }
            }

            .alert {
                  padding: 16px 20px;
                  border-radius: 12px;
                  margin-top: 16px;
                  font-size: 0.9375rem;
                  animation: slideDown 0.3s ease;
            }

            .alert-success {
                  background: #f0fdf4;
                  border: 1px solid #86efac;
                  color: #166534;
            }

            .alert-error {
                  background: #fef2f2;
                  border: 1px solid #fca5a5;
                  color: #991b1b;
            }

            .question-section {
                  margin-top: 32px;
                  padding-top: 32px;
                  border-top: 2px solid #e2e8f0;
            }

            .section-title {
                  font-size: 1.5rem;
                  font-weight: 600;
                  color: #1a202c;
                  margin-bottom: 24px;
                  display: flex;
                  align-items: center;
                  gap: 12px;
            }

            .icon-circle {
                  width: 40px;
                  height: 40px;
                  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                  border-radius: 50%;
                  display: flex;
                  align-items: center;
                  justify-content: center;
            }

            .icon-circle svg {
                  width: 20px;
                  height: 20px;
                  stroke: white;
                  fill: none;
                  stroke-width: 2;
            }
      </style>
</head>
<body>
      <div class="main-container">
            <div class="card">
                  <div class="header">
                        <h1>Receipt Analyzer AI</h1>
                        <p>Upload and analyze your receipts instantly</p>
                  </div>

                  <form id="receiptForm" method="POST" action="/analyze-receipt" enctype="multipart/form-data">
                        <div class="upload-area" id="uploadArea">
                              <div class="upload-icon">
                                    <svg viewBox="0 0 24 24">
                                          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                              </div>
                              <div class="upload-text">Drop your receipt here</div>
                              <div class="upload-subtext">or click to browse (PNG, JPG, JPEG)</div>
                              <input type="file" id="receipt" name="receipt" accept="image/*" required>
                        </div>

                        <div class="preview-container" id="previewContainer"></div>

                        <button type="submit" class="btn btn-primary" id="analyzeBtn">
                              <span id="btnText">Analyze Receipt</span>
                              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M5 12h14M12 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                        </button>
                  </form>
            </div>

            <div class="card results-panel" id="resultsPanel">
                  <div class="section-title">
                        <div class="icon-circle">
                              <svg viewBox="0 0 24 24">
                                    <path d="M9 11l3 3L22 4M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                        </div>
                        Analysis Results
                  </div>

                  <div id="resultContent"></div>

                  <div class="question-section" id="questionSection" style="display: none;">
                        <div class="section-title">
                              <div class="icon-circle">
                                    <svg viewBox="0 0 24 24">
                                          <circle cx="12" cy="12" r="10"/>
                                          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                              </div>
                              Ask a Question
                        </div>

                        <input
                              type="text"
                              id="question"
                              class="question-input"
                              placeholder="What would you like to know about this receipt?"
                        >

                        <button id="askButton" class="btn btn-secondary">
                              <span id="askBtnText">Get Answer</span>
                              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                        </button>

                        <div class="answer-box" id="answerBox"></div>
                  </div>
            </div>
      </div>

      <script>
            const form = document.getElementById('receiptForm');
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('receipt');
            const previewContainer = document.getElementById('previewContainer');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const btnText = document.getElementById('btnText');
            const resultsPanel = document.getElementById('resultsPanel');
            const resultContent = document.getElementById('resultContent');
            const questionSection = document.getElementById('questionSection');
            const askButton = document.getElementById('askButton');
            const questionInput = document.getElementById('question');
            const answerBox = document.getElementById('answerBox');
            const askBtnText = document.getElementById('askBtnText');

            let analyzedData = null;

            uploadArea.addEventListener('click', () => fileInput.click());

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                  uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                  e.preventDefault();
                  e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                  uploadArea.addEventListener(eventName, () => {
                        uploadArea.classList.add('dragover');
                  }, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                  uploadArea.addEventListener(eventName, () => {
                        uploadArea.classList.remove('dragover');
                  }, false);
            });

            uploadArea.addEventListener('drop', (e) => {
                  const dt = e.dataTransfer;
                  const files = dt.files;
                  fileInput.files = files;
                  handleFileSelect();
            });

            fileInput.addEventListener('change', handleFileSelect);

            function handleFileSelect() {
                  const file = fileInput.files[0];
                  if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                              previewContainer.innerHTML = `<img src="${e.target.result}" alt="Receipt Preview">`;
                              previewContainer.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                  }
            }

            form.addEventListener('submit', async (e) => {
                  e.preventDefault();

                  analyzeBtn.disabled = true;
                  btnText.innerHTML = '<span class="loading"></span> Analyzing...';
                  resultContent.innerHTML = '';
                  resultsPanel.classList.remove('active');
                  questionSection.style.display = 'none';
                  answerBox.classList.remove('active');

                  const formData = new FormData(form);

                  try {
                        const response = await fetch('/analyze-receipt', {
                              method: 'POST',
                              body: formData
                        });

                        const result = await response.text();

                        if (response.ok) {
                              analyzedData = result;
                              resultsPanel.classList.add('active');

                              resultContent.innerHTML = `
                                    <span class="badge">Analysis Complete</span>
                                    <div class="result-box">
                                          <h3>Extracted Information</h3>
                                          <div class="result-content">${result}</div>
                                    </div>
                              `;

                              questionSection.style.display = 'block';

                              setTimeout(() => {
                                    resultsPanel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                              }, 100);
                        } else {
                              resultContent.innerHTML = `
                                    <div class="alert alert-error">
                                          ${result}
                                    </div>
                              `;
                              resultsPanel.classList.add('active');
                        }
                  } catch (error) {
                        resultContent.innerHTML = `
                              <div class="alert alert-error">
                                    Error: ${error.message}
                              </div>
                        `;
                        resultsPanel.classList.add('active');
                  } finally {
                        analyzeBtn.disabled = false;
                        btnText.innerHTML = 'Analyze Receipt';
                  }
            });

            questionInput.addEventListener('keypress', (e) => {
                  if (e.key === 'Enter') {
                        askButton.click();
                  }
            });

            askButton.addEventListener('click', async () => {
                  const question = questionInput.value.trim();
                  if (!question) {
                        answerBox.innerHTML = '<div class="alert alert-error">Please enter a question.</div>';
                        answerBox.classList.add('active');
                        return;
                  }

                  askButton.disabled = true;
                  askBtnText.innerHTML = '<span class="loading"></span> Thinking...';
                  answerBox.classList.remove('active');

                  try {
                        const response = await fetch('/ask-question', {
                              method: 'POST',
                              headers: {
                                    'Content-Type': 'application/json',
                              },
                              body: JSON.stringify({ question }),
                        });

                        const answer = await response.text();

                        if (response.ok) {
                              answerBox.innerHTML = `
                                    <div style="margin-bottom: 12px; font-weight: 600; color: #667eea;">
                                          Answer:
                                    </div>
                                    <p>${answer}</p>
                              `;
                              answerBox.classList.add('active');
                        } else {
                              answerBox.innerHTML = `<div class="alert alert-error">${answer}</div>`;
                              answerBox.classList.add('active');
                        }
                  } catch (error) {
                        answerBox.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
                        answerBox.classList.add('active');
                  } finally {
                        askButton.disabled = false;
                        askBtnText.innerHTML = 'Get Answer';
                  }
            });
      </script>
</body>
</html>
